<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Chat Room</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Reset & font */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
/* Login */
.login-container{width:90%;max-width:450px;background:rgba(30,41,59,0.8);backdrop-filter:blur(10px);padding:30px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.5);text-align:center;animation:fadeIn 0.8s ease;border:1px solid rgba(56,189,248,0.2);}
.login-header{margin-bottom:25px;color:#38bdf8;font-size:28px;display:flex;flex-direction:column;align-items:center;gap:10px;}
.login-icon{font-size:40px;color:#38bdf8;animation:pulse 2s infinite;}
.input-group{position:relative;margin-bottom:20px;}
.input-group input{width:100%;padding:15px 15px 15px 45px;border-radius:8px;border:2px solid rgba(56,189,248,0.3);outline:none;font-size:16px;background:rgba(15,23,42,0.6);color:#fff;transition:all 0.3s;}
.input-group input:focus{border-color:#38bdf8;box-shadow:0 0 15px rgba(56,189,248,0.4);}
.input-group i{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#38bdf8;font-size:18px;}
.login-btn{width:100%;padding:15px;border:none;border-radius:8px;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(37,99,235,0.4);}
.login-btn:hover{background:linear-gradient(135deg,#1d4ed8,#1e40af);transform:translateY(-2px);box-shadow:0 6px 20px rgba(37,99,235,0.6);}

/* Chat */
.chat-container{display:none;flex-direction:column;width:90%;max-width:800px;height:90vh;background:rgba(30,41,59,0.8);backdrop-filter:blur(10px);border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.5);border:1px solid rgba(56,189,248,0.2);animation:scaleIn 0.5s ease;}
.chat-header{background:rgba(17,24,39,0.9);padding:20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(56,189,248,0.2);}
.chat-title{font-size:22px;color:#38bdf8;display:flex;align-items:center;gap:10px;}
.user-info{display:flex;align-items:center;gap:10px;background:rgba(56,189,248,0.2);padding:8px 15px;border-radius:20px;}
.user-info i{color:#38bdf8;}
.chat-box{flex:1;padding:20px;overflow-y:auto;background:rgba(17,24,39,0.4);display:flex;flex-direction:column;gap:15px;}
.message{max-width:70%;padding:12px 18px;border-radius:18px;animation:fadeIn 0.3s ease;position:relative;word-wrap:break-word;}
.message-incoming{background:rgba(55,65,81,0.8);align-self:flex-start;border-bottom-left-radius:5px;}
.message-outgoing{background:linear-gradient(135deg,#2563eb,#1d4ed8);align-self:flex-end;border-bottom-right-radius:5px;}
.message-user{font-weight:bold;margin-bottom:5px;font-size:14px;}
.message-incoming .message-user{color:#93c5fd;}
.message-outgoing .message-user{color:#bfdbfe;}
.message-text{line-height:1.4;}
.message-time{font-size:11px;opacity:0.7;text-align:right;margin-top:5px;}
.chat-input{display:flex;padding:15px;gap:10px;background:rgba(17,24,39,0.9);border-top:1px solid rgba(56,189,248,0.2);}
.message-input{flex:1;padding:15px;border-radius:25px;border:2px solid rgba(56,189,248,0.3);outline:none;font-size:16px;background:rgba(15,23,42,0.6);color:#fff;transition:all 0.3s;}
.message-input:focus{border-color:#38bdf8;box-shadow:0 0 15px rgba(56,189,248,0.4);}
.send-btn{width:50px;height:50px;border-radius:50%;border:none;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;font-size:18px;cursor:pointer;display:flex;justify-content:center;align-items:center;transition:all 0.3s;box-shadow:0 4px 15px rgba(37,99,235,0.4);}
.send-btn:hover{background:linear-gradient(135deg,#1d4ed8,#1e40af);transform:rotate(15deg) scale(1.1);}

/* Animations */
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);}}

/* Scrollbar */
::-webkit-scrollbar{width:8px;}
::-webkit-scrollbar-track{background:rgba(15,23,42,0.3);border-radius:10px;}
::-webkit-scrollbar-thumb{background:rgba(56,189,248,0.5);border-radius:10px;}
::-webkit-scrollbar-thumb:hover{background:rgba(56,189,248,0.7);}

/* Responsive */
@media (max-width:768px){.chat-container{width:95%;height:95vh;}.message{max-width:85%;}.chat-header{flex-direction:column;gap:10px;text-align:center;}}
</style>
</head>
<body>

<div class="login-container" id="loginSection">
  <div class="login-header">
    <i class="fas fa-comments login-icon"></i>
    <h2>Join Chat</h2>
  </div>
  <div class="input-group">
    <i class="fas fa-user"></i>
    <input type="text" id="loginName" placeholder="Enter your username" autocomplete="off">
  </div>
  <button class="login-btn" onclick="login()">Enter Chat Room</button>
  <p style="margin-top:20px;opacity:0.7;font-size:14px;"><i class="fas fa-info-circle"></i> Your username will be visible to others in the chat</p>
</div>

<div class="chat-container" id="chatSection">
  <div class="chat-header">
    <div class="chat-title">
      <i class="fas fa-globe-americas"></i>
      <h2>Public Chat Room</h2>
    </div>
    <div class="user-info">
      <i class="fas fa-user"></i>
      <span id="currentUsername">Username</span>
    </div>
  </div>
  <div class="chat-box" id="chatBox"></div>
  <div class="chat-input">
    <input type="text" class="message-input" id="message" placeholder="Type your message..." autocomplete="off">
    <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
  </div>
</div>

<script>
const API_KEY = "$2a$10$TUB.ZiKW3b9B7mCeFi2YWea4XifkN7zmT9N9zEqMvgA5xFePB1ALa";
const BIN_ID = "68d05be243b1c97be94ab150";
const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

let username = "";

// Login
function login(){
  const name = document.getElementById("loginName").value.trim();
  if(!name){showNotification("Please enter a username!");return;}
  username = name;
  localStorage.setItem("chatUser", name);
  document.getElementById("currentUsername").textContent = name;
  document.getElementById("loginSection").style.display = "none";
  document.getElementById("chatSection").style.display = "flex";
  loadMessages();
}

// Notification
function showNotification(msg){
  const n = document.createElement("div");
  n.textContent = msg;
  n.style.position = "fixed";
  n.style.bottom="20px"; n.style.left="50%"; n.style.transform="translateX(-50%)";
  n.style.backgroundColor="#ef4444"; n.style.color="white"; n.style.padding="10px 20px";
  n.style.borderRadius="5px"; n.style.zIndex="1000"; n.style.boxShadow="0 4px 10px rgba(0,0,0,0.3)";
  document.body.appendChild(n);
  setTimeout(()=>{n.style.opacity="0"; n.style.transition="opacity 0.5s"; setTimeout(()=>document.body.removeChild(n),500);},3000);
}

// Auto login
window.onload = function(){
  const saved = localStorage.getItem("chatUser");
  if(saved){document.getElementById("loginName").value = saved; login();}
  document.getElementById("loginName").addEventListener("keypress", function(e){if(e.key==="Enter") login();});
  document.getElementById("message").addEventListener("keypress", function(e){if(e.key==="Enter") sendMessage();});
};

// Format time
function formatTime(date){return date.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}

// Load messages
async function loadMessages(){
  try{
    const res = await fetch(API_URL,{headers:{"X-Master-Key":API_KEY}});
    const data = await res.json();
    const messages = data.record.messages||[];
    const chatBox = document.getElementById("chatBox");
    chatBox.innerHTML = "";
    
    for (var i = 0; i < messages.length; i++) {
        var msg = messages[i];
        var div = document.createElement("div");
        var isCurrentUser = msg.user === username;
        
        div.className = "message " + (isCurrentUser ? "message-outgoing" : "message-incoming");
        div.innerHTML = "<div class='message-user'>" + msg.user + "</div>" +
                        "<div class='message-text'>" + msg.text + "</div>" +
                        "<div class='message-time'>" + formatTime(new Date(msg.time || Date.now())) + "</div>";
        chatBox.appendChild(div);
    }
    
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch(e) {
    console.error("Error loading messages:", e);
  }
}

// Send message
async function sendMessage() {
  var messageInput = document.getElementById("message");
  var text = messageInput.value.trim();
  if(!text) return;
  
  try {
    const res = await fetch(API_URL, {headers:{"X-Master-Key":API_KEY}});
    const data = await res.json();
    var messages = data.record.messages || [];
    messages.push({user: username, text: text, time: new Date().toISOString()});
    
    await fetch(API_URL, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": API_KEY
      },
      body: JSON.stringify({messages: messages})
    });
    
    messageInput.value = "";
    loadMessages(); // Hanya load setelah kirim pesan
  } catch(e) {
    console.error("Error sending message:", e);
    showNotification("Failed to send message. Please try again.");
  }
}
</script>

</body>
</html>
